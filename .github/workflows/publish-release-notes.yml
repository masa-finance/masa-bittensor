name: Publish Release Notes

on:
  release:
    types: [published]

jobs:
  publish-release-notes:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Get release notes
        run: |
          RELEASE_NOTES=$(curl -s https://api.github.com/repos/${{ github.repository }}/releases/latest | jq -r .body)
          echo "RELEASE_NOTES<<EOF" >> $GITHUB_ENV
          echo "$RELEASE_NOTES" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: Update RELEASE_NOTES.md
        run: |
          echo -e "## Masa Bittensor Release Notes\n\n${{ env.RELEASE_NOTES }}\n\n[All Releases](https://github.com/${{ github.repository }}/releases)" > docs/RELEASE_NOTES.md

      - name: Commit changes
        run: |
          git config --global user.name 'github-actions'
          git config --global user.email 'github-actions@github.com'
          git add docs/RELEASE_NOTES.md
          git commit -m "chore: update release notes"

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: update release notes"
          branch: docs/update-release-notes
          title: "chore: update release notes"
          body: "This PR is automated and orchestrated by the release workflow.  It updates the release notes in docs/RELEASE_NOTES.md every time a new release is published.  This automation ensures that our documentation is always up to date with the latest release notes, and links out to all previous release notes as well.  This bot makes the description of this PR just a little bit longer as to pass our CI checks!"
